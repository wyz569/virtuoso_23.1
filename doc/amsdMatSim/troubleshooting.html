
<html><head><title>Troubleshooting</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="Approver" content="Technical Publications" />
<meta name="Author" content="shubh" />
<meta name="CreateDate" content="2023-06-13" />
<meta name="CreateTime" content="1686640366" />
<meta name="DataType" content="Manuals" />
<meta name="Description" content="Describes how to cosimulate a system containing analog and mixed-signal subsystems using the Virtuoso AMS Designer simulator and MathWorks MATLAB/Simulink" />
<meta name="DocTitle" content="Spectre AMS Designer Cosimulation with MathWorks MATLAB/Simulink" />
<meta name="DocType" content="Getting Started" />
<meta name="FileTitle" content="Troubleshooting" />
<meta name="FileType" content="Chapter" />
<meta name="FMWikiRelease" content="FM-Wiki-4.0.0" />
<meta name="Keyword" content="amsdMatSim" />
<meta name="Language" content="English" />
<meta name="ModifiedDate" content="2023-06-13" />
<meta name="ModifiedTime" content="1686640366" />
<meta name="NextFile" content="" />
<meta name="Group" content="" />
<meta name="Platform" content="Custom IC Design,Custom IC Design" />
<meta name="PrevFile" content="learningMore.html" />
<meta name="c_product" content="AMS Designer,Virtuoso Analog Design Environment" />
<meta name="Product" content="AMS Designer,Virtuoso Analog Design Environment" />
<meta name="ProductFamily" content="AMS Designer,Virtuoso Analog Design Environment" />
<meta name="ProductVersion" content="IC23.1" />
<meta name="RightsManagement" content="Copyright 2023 Cadence Design Systems Inc." />
<meta name="Title" content="Spectre AMS Designer Cosimulation with MathWorks MATLAB/Simulink -- Troubleshooting" />
<meta name="Keywords" content="" />
<meta name="topic_type" content="" />
<meta name="reference_type" content="" />
<meta name="prod_feature" content="" />
<meta name="prod_subfeature" content="" />
<meta name="new_topic" content="No" />
<meta name="spotlight_topic" content="0" />
<meta name="Version" content="IC23.1" />
<meta name="SpaceKey" content="amsdMatSimIC231" />
<meta name="webflare-version" content="2.5" />
<link rel="stylesheet" href="styles/webflare.css" type="text/css" />


  <script>/*<![CDATA[*/
 document.addEventListener("DOMContentLoaded", function(event) {  document.querySelectorAll("img").forEach((img, index) => {
if (img.hasAttribute("usemap")){return;}else{img.classList.add("cursorclass");} img.addEventListener("click", (e) => {if(img.hasAttribute("usemap")){            img.setAttribute("style","cursor:none;");return;};document.querySelector("#cad_image_modal").classList.add("opac");document.querySelector("#cad_image_modal_center").innerHTML = `<img style="position:absolute;top:0;bottom:0;left:0;right:0;margin: auto;max-height:95%;"  src="${e.target.src}">`;});});});
/*]]>*/</script> 




 <style>/*<![CDATA[*/
.cursorclass{cursor:pointer;}#cad_image_modal{position:fixed;left:0;top:0;width:100%;background:#00000099;overflow:hidden;height:0;opacity:0;transition: height 0ms 1s, opacity 1s 0ms;}#cad_image_modal.opac{height: 100%;opacity: 1;transition: height 0ms 0ms, opacity 1s 0ms;}#cad_image_modal span{position:fixed;right:10px;top:10px;cursor:pointer;color:#fff;}
/*]]>*/</style> 
</head><body style="background-color: #FFFFFF;"><a name="pagetop"></a>
<!-- Begin Buttons -->
<header><div class="docHeadr">Product Documentation<img src="icons/Cadence-Logo.jpg" /></div><nav class="blueHead"><ul><li><a class="content" href="amsdMatSimTOC.html">Contents</a></li><li><a class="prev" href="learningMore.html" title="Learning More about the Cosimulation Interface">Learning More about the Cosimu ...</a></li><li style="float: right;"><a class="viewPrint" href="amsdMatSim.pdf">View/Print PDF</a></li></ul></nav></header>
<!-- End Buttons -->
<h5><center>Spectre AMS Designer Cosimulation with MathWorks MATLAB/Simulink<br />Product Version IC23.1, June 2023</center></h5><div id="main-content" style="min-height: 50vh; margin-left: 5%; margin-right: 2%;"><a name="#firstpage"></a>

<h1>B
<a id="pgfId-1032955"></a></h1>
<h1>
<a id="pgfId-1035250"></a><hr />
Troubleshooting<hr />
</h1>

<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1037049"></a><em>AMS-MATLAB/Simulink cosimulation</em> stands for cosimulation using the Spectre AMS Designer simulator and The MathWorks MATLAB<sup>&#174;</sup>/Simulink<sup>&#174;</sup>. <em>ADE</em> stands for the Virtuoso Analog Design Environment. </div>
<p>
<a id="pgfId-1040332"></a>The coupler module prints messages to the MATLAB main window and to the AMS Designer/<code>xmsim</code> console. The UNIX version of the Simulink coupler block also writes messages to the <code>SimCoupler.log</code> file in the MATLAB run directory. These messages can help you troubleshoot problems. </p>

<h2>
<a id="pgfId-1040333"></a>Possible Problems</h2>

<p>
<a id="pgfId-1040439"></a>Here are some possible problems you might encounter and what you can do. </p>

<h4><em>
<a id="pgfId-1040442"></a>SimVision does not come up, NC elaboration failed</em></h4>

<p>
<a id="pgfId-1040443"></a>Netlist the design again and restart elaboration/simulation. Check for error messages in the output window or in the log files. </p>
<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1040732"></a>If you are using the ADE flow, Simvision does not appear unless you have specified interactive mode. </div>

<h4><em>
<a id="pgfId-1040445"></a>The cosimulation cannot be established</em></h4>

<p>
<a id="pgfId-1040446"></a>If AMS Designer/<code>xcelium</code> terminates immediately after starting the simulation run and the AMS Designer/<code>xcelium</code> console closes, go to the dedicated AMS run directory and review the <code>xmsim.log</code> file. Coupler module messages appear at the end of this file. </p>
<p>
<a id="pgfId-1040751"></a>For example: </p>

<pre class="webflare-courier-new codeContent">
<a id="pgfId-1040447"></a>ncsim&gt; run <br />initializing couple module &#39;tb_sine.I6&#39; <br />ERROR: connecting to socket failed, sockfd=16, host=localhost, port=5023 <br />       errno=111: Connection refused <br />ERROR: can&#39;t create new connection to &#39;localhost&#39; at port 5023 (Master simulator not running?) </pre>

<p>
<a id="pgfId-1040452"></a>The coupler module cannot connect to MATLAB. Here are some possible reasons and work-arounds: </p>

<ol><li>
<a id="pgfId-1040453"></a>The Simulink simulation did not start or has stopped as a result of the time-out settings.<br />
<a id="pgfId-1040804"></a>Try again. Start the Simulink simulation before the AMS Designer/<code>xmsim</code> simulation. Wait for the MATLAB initialization phase to finish before starting AMS Designer. Do not wait longer than the time-out before starting AMS Designer. </li><li>
<a id="pgfId-1040805"></a>The simulators are using different socket ports. <br />
<a id="pgfId-1040808"></a>Check the settings in MATLAB and in the Virtuoso schematic editor. If there are differences, change the port numbers so that they match. </li><li>
<a id="pgfId-1040455"></a>MATLAB does not run on the specified host. <br />
<a id="pgfId-1040821"></a>Check the <code>Hostname</code> parameter of the coupler module on the Virtuoso schematic. 
The default value is <code>localhost</code>. </li><li>
<a id="pgfId-1040456"></a>Another service is using the socket port. <br />
<a id="pgfId-1040785"></a>Change to another port on both sides. </li></ol>















<h4><em>
<a id="pgfId-1040458"></a>The simulation ends before the desired time</em></h4>

<p>
<a id="pgfId-1040459"></a>The cosimulation terminates when one of the simulators reaches its stop time. On the AMS Designer side, you configure this setting on the ADE Choosing Analyses form or in the Virtuoso<sup>&#174;</sup> Hierarchy Editor on the Netlist and Run form (or by choosing <em>AMS &#8211; Detailed Setup &#8211; Analyses</em>). In Simulink, choose <em>Simulation &#8211; Configuration Parameters</em> and type a simulation stop time in the <em>Stop time</em> field on the Configuration Parameters form.</p>

<h4><em>
<a id="pgfId-1040461"></a>When using framed signals the Simulink coupler module reports the error &quot;lookup ports failed&quot;</em></h4>

<p>
<a id="pgfId-1040898"></a>The software limits the maximum frame size to 10,000 for each input signal. If your application requires a larger frame size, contact Cadence for support. </p>

<div class="webflare-information-macro webflare-macro-information">
<a id="pgfId-1040899"></a>
All connected signals must have the same frame size. </div>
<h2>
<a id="pgfId-1040416"></a>Possible Simulink Errors</h2>

<p>
<a id="pgfId-1040420"></a>Here are some possible Simulink error messages and how you might handle them. </p>

<h4><em>
<a id="pgfId-1040334"></a>&quot;Illegal rate transition found involving block &#39;sine_tb_frame/SimCoupler&#39; at 
input port 2. A rate transition block must be inserted between the two blocks.&quot;</em></h4>

<p>
<a id="pgfId-1040335"></a>Simulink generates this error by default only for the multitasking solver mode of its fixed-step solver when signals with different sample rates connect to the same block. In framed mode, the cosimulation produces wrong results when signals with different sample rates connect to the Simulink coupler module. </p>
<p>
<a id="pgfId-1040567"></a>We recommend that you turn on this error message for single-task mode. All models in the AMS Designer/Simulink Cosimulation Library that use framed signals have this option turned on. To turn on this error message for single-task mode, do the following: </p>

<ol><li>
<a id="pgfId-1040502"></a>In the testbench schematic window, choose Simulation &#8211; Configuration Parameters. <br />
<a id="pgfId-1040510"></a>The Configuration Parameters form appears. </li><li>
<a id="pgfId-1040511"></a>Select <em>Diagnostics</em>, <em>Sample Time</em>. </li><li>
<a id="pgfId-1040503"></a>In the <em>Single task rate transition</em> field, select <em>error</em>. <br />
<a id="pgfId-1040490"></a><div class="webflare-div-image">
<img src="images/SampleTime.gif" /></div></li><li>
<a id="pgfId-1040547"></a>Click <em>OK</em>. </li></ol>








<h4><em>
<a id="pgfId-1040338"></a>&quot;Error reported by S-function &#39;SimCoupler&#39; in block &#39;sine_tb_frame/SimCoupler&#39;: 
could not determine block sample rate, try using the fixed step solver&quot;</em></h4>

<p>
<a id="pgfId-1040339"></a>You can only use the Simulink coupler module whose <em>Frame mode</em> is set to <em>framed</em> in models that have fixed sample rates. (You specify the <em>Frame mode</em> on the Function Block Parameters form.) </p>

<p>
<a id="pgfId-1040597"></a></p>
<div class="webflare-div-image">
<img src="images/input3output2.gif" /></div>

<p>
<a id="pgfId-1040617"></a>You can use the variable step solver as long as the coupler module has a fixed sample rate. To turn on sample time coloring so that you can inspect the sample rates in your model, do the following: </p>
<ul><li>
<a id="pgfId-1040663"></a>In the testbench schematic window, choose <em>Format &#8211; Port/Signal Displays &#8211; Sample Time Colors</em>.<br />
<a id="pgfId-1040674"></a>Black and gray indicate a variable sample time, which you cannot have in framed mode. Also, you cannot have different sample times at the coupler module (see the previous Simulink error message). </li></ul>

<p>
<a id="pgfId-1040198"></a></p>

<br /><a href="#pagetop">Return to top</a><br /></div>
<!-- Begin Buttons --><!-- End Buttons -->
<footer><nav class="navigation"><b><em><a href="learningMore.html" id="prev" title="Learning More about the Cosimulation Interface">Learning More about the Cosimu ...</a></em></b></nav><div>
            For further assistance, contact <a href="https://support.cadence.com">Cadence Online Support</a>. Copyright &#169; 2023, <a href="https://www.cadence.com">Cadence Design Systems, Inc.</a> All rights reserved. 
          </div></footer>
 

 <div id="cad_image_modal" style="background-color: rgba(0, 0, 0, 0.6);"><center id="cad_image_modal_center">&#160;â € </center><span style="margin-right:50px;margin-top:100px;font-weight:bold;font-size:20px;background:#e5e5e5;border:1px solid #e5e5e5;border-radius:25px;height:30px;width:20px;padding-left:6px;padding-top:2px;color: black;" onclick="document.querySelector('#cad_image_modal').classList.remove('opac');">X</span></div> 

</body></html>