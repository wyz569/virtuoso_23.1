
<html><head><title>Running Cosimulation from ADE Using the Fixed-Cell Coupler</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="Approver" content="Technical Publications" />
<meta name="Author" content="shubh" />
<meta name="CreateDate" content="2023-06-13" />
<meta name="CreateTime" content="1686640367" />
<meta name="DataType" content="Manuals" />
<meta name="Description" content="Describes how to cosimulate a system containing analog and mixed-signal subsystems using the Virtuoso AMS Designer simulator and MathWorks MATLAB/Simulink" />
<meta name="DocTitle" content="Spectre AMS Designer Cosimulation with MathWorks MATLAB/Simulink" />
<meta name="DocType" content="Getting Started" />
<meta name="FileTitle" content="Running Cosimulation from ADE Using the Fixed-Cell Coupler" />
<meta name="FileType" content="Chapter" />
<meta name="FMWikiRelease" content="FM-Wiki-4.0.0" />
<meta name="Keyword" content="amsdMatSim" />
<meta name="Language" content="English" />
<meta name="ModifiedDate" content="2023-06-13" />
<meta name="ModifiedTime" content="1686640367" />
<meta name="NextFile" content="tutorial2.html" />
<meta name="Group" content="" />
<meta name="Platform" content="Custom IC Design,Custom IC Design" />
<meta name="PrevFile" content="setup.html" />
<meta name="c_product" content="AMS Designer,Virtuoso Analog Design Environment" />
<meta name="Product" content="AMS Designer,Virtuoso Analog Design Environment" />
<meta name="ProductFamily" content="AMS Designer,Virtuoso Analog Design Environment" />
<meta name="ProductVersion" content="IC23.1" />
<meta name="RightsManagement" content="Copyright 2023 Cadence Design Systems Inc." />
<meta name="Title" content="Spectre AMS Designer Cosimulation with MathWorks MATLAB/Simulink -- Running Cosimulation from ADE Using the Fixed-Cell Coupler" />
<meta name="Keywords" content="" />
<meta name="topic_type" content="" />
<meta name="reference_type" content="" />
<meta name="prod_feature" content="" />
<meta name="prod_subfeature" content="" />
<meta name="new_topic" content="No" />
<meta name="spotlight_topic" content="0" />
<meta name="Version" content="IC23.1" />
<meta name="SpaceKey" content="amsdMatSimIC231" />
<meta name="webflare-version" content="2.5" />
<link rel="stylesheet" href="styles/webflare.css" type="text/css" />


  <script>/*<![CDATA[*/
 document.addEventListener("DOMContentLoaded", function(event) {  document.querySelectorAll("img").forEach((img, index) => {
if (img.hasAttribute("usemap")){return;}else{img.classList.add("cursorclass");} img.addEventListener("click", (e) => {if(img.hasAttribute("usemap")){            img.setAttribute("style","cursor:none;");return;};document.querySelector("#cad_image_modal").classList.add("opac");document.querySelector("#cad_image_modal_center").innerHTML = `<img style="position:absolute;top:0;bottom:0;left:0;right:0;margin: auto;max-height:95%;"  src="${e.target.src}">`;});});});
/*]]>*/</script> 




 <style>/*<![CDATA[*/
.cursorclass{cursor:pointer;}#cad_image_modal{position:fixed;left:0;top:0;width:100%;background:#00000099;overflow:hidden;height:0;opacity:0;transition: height 0ms 1s, opacity 1s 0ms;}#cad_image_modal.opac{height: 100%;opacity: 1;transition: height 0ms 0ms, opacity 1s 0ms;}#cad_image_modal span{position:fixed;right:10px;top:10px;cursor:pointer;color:#fff;}
/*]]>*/</style> 
</head><body style="background-color: #FFFFFF;"><a name="pagetop"></a>
<!-- Begin Buttons -->
<header><div class="docHeadr">Product Documentation<img src="icons/Cadence-Logo.jpg" /></div><nav class="blueHead"><ul><li><a class="content" href="amsdMatSimTOC.html">Contents</a></li><li><a class="prev" href="setup.html" title="AMS-MATLAB/Simulink Cosimulation">AMS-MATLAB/Simulink Cosimulati ...</a></li><li style="float: right;"><a class="viewPrint" href="amsdMatSim.pdf">View/Print PDF</a></li><li style="float: right;margin-right: 25px;"><a class="nextd" href="tutorial2.html" title="Running Cosimulation from ADE Using the simulinkCoupler">Running Cosimulation from ADE  ...</a></li></ul></nav></header>
<!-- End Buttons -->
<h5><center>Spectre AMS Designer Cosimulation with MathWorks MATLAB/Simulink<br />Product Version IC23.1, June 2023</center></h5><div id="main-content" style="min-height: 50vh; margin-left: 5%; margin-right: 2%;"><a name="#firstpage"></a>

<h1>2
<a id="pgfId-1032955"></a></h1>
<h1>
<a id="pgfId-1035250"></a><hr />
<a id="33895"></a>Running Cosimulation from ADE Using the Fixed-Cell Coupler<hr />
</h1>

<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1037049"></a><em>AMS-MATLAB/Simulink cosimulation</em> stands for cosimulation using the Spectre AMS Designer simulator and The MathWorks MATLAB<sup>&#174;</sup>/Simulink<sup>&#174;</sup>. <em>ADE</em> stands for the Virtuoso Analog Design Environment. </div>

<div class="webflare-information-macro webflare-macro-information">
<a id="pgfId-1037083"></a>
Use IC 6.1.3, IUS 8.1 or later, and MATLAB704R14 or MATLAB R2007b or MATLAB R2008a for this tutorial. The estimated time to complete this tutorial is about one hour. </div>
<p>
<a id="pgfId-1040484"></a>For information about the fixed-cell coupler, see <a href="setup.html#91579">&#8220;Creating the Coupler in the Schematic Window&#8221;</a>. </p>
<p>
<a id="pgfId-1041510"></a>To run cosimulation from ADE using the fixed-cell coupler, do the following: </p>
<ol><li>
<a id="pgfId-1040486"></a>If you have not <a href="setup.html#openSchematic">already done so</a>, open the RF Transmitter System Testbench config. <br />
<a id="pgfId-1040487"></a>Shortcut: You can open the finished config/schematic that we provide with this tutorial: <code>AMSDcouple/tb_ieee_802_11a_demo</code>. </li><li>
<a id="pgfId-1041681"></a><a href="tutorial1.html#analysisSetup">Open the Virtuoso Analog Design Environment (ADE) and set up the analysis</a>. </li><li>
<a id="pgfId-1041688"></a><a href="tutorial1.html#choose_irun">Choose xrun for simulation</a>. </li><li>
<a id="pgfId-1041683"></a><a actuate="user" class="URL" href="../amsdMatSim/tutorial1.html#beforeAMSstarts" show="replace" xml:link="simple">View AMS simulator options</a>. </li><li>
<a id="pgfId-1041685"></a><a href="tutorial1.html#setUpDesVars">Specify values for the design variables</a>. </li><li>
<a id="pgfId-1040711"></a><a href="tutorial1.html#beforeAMSstarts">Set up the MATLAB/Simulink simulation to start before the AMS Designer simulation</a>. </li><li>
<a id="pgfId-1040718"></a><a href="tutorial1.html#cosimADE">Run cosimulation from ADE</a>. </li><li>
<a id="pgfId-1041312"></a><a href="tutorial1.html#cosimADEchangevalue">Rerun the cosimulation after changing a design variable value</a>. </li><li>
<a id="pgfId-1041313"></a><a href="tutorial1.html#cosimADEseparate">Run cosimulation by starting two simulations separately</a>. </li></ol>











<h2>
<a id="pgfId-1040519"></a><a id="98854"></a>Opening ADE and Setting Up the <a id="analysisSetup"></a>Analysis</h2>
<p>
<a id="pgfId-1040520"></a>To open ADE and set up the analysis, do the following: </p>
<ol><li>
<a id="pgfId-1040364"></a>In the schematic window, choose <em>Launch &#8211; ADE L</em>. <br />
<a id="pgfId-1040401"></a><em>Simulator: ams(Spectre)</em> appears on the status bar. <br />
<a id="pgfId-1040431"></a><div class="webflare-div-image">
<img width="660" height="405" src="images/tutorial1-3.gif" /></div></li><li>
<a id="pgfId-1040412"></a>Choose <em>Analyses &#8211; Choose</em>. <br />
<a id="pgfId-1040441"></a>The Choosing Analyses form appears. </li><li>
<a id="pgfId-1040442"></a>In the <em>Stop Time</em> field, type <code>1m</code>. </li><li>
<a id="pgfId-1040448"></a>Turn on the <em>Enabled</em> check box. <br />
<a id="pgfId-1040459"></a><div class="webflare-div-image">
<img width="448" height="487" src="images/tutorial1-4.gif" /></div></li><li>
<a id="pgfId-1040455"></a>Click <em>OK</em>. <br />
<a id="pgfId-1040569"></a>The analysis setup appears in the <em>Analyses</em> section of the ADE window. <br />
<a id="pgfId-1040578"></a><div class="webflare-div-image">
<img width="240" height="140" src="images/tutorial1-5.gif" /></div></li></ol>



















<h2>
<a id="pgfId-1040198"></a>Choosing xrun for <a id="choose_irun"></a>Simulation</h2>
<p>
<a id="pgfId-1041527"></a>To choose <code>xrun</code> for simulation, do the following: </p>
<ol><li>
<a id="pgfId-1041532"></a>In ADE, choose <em>Simulation &#8211; Netlist and Run Options</em>. <br />
<a id="pgfId-1041533"></a>The Netlist and Run Options form appears. </li><li>
<a id="pgfId-1041534"></a>In the <em>NETLIST AND RUN MODE</em> section at the top of the form, select <em>OSS-based netlister with xrun</em>. <br />
<a id="pgfId-1043362"></a><div class="webflare-div-image">
<img width="450" height="603" src="images/tutorial1-6.gif" /></div></li></ol>







<div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1041548"></a>The options that you see in the form depends upon your installation path. If you have Xcelium in your installation path, then, you will see Xcelium-related commands, such as xrun, xmvlog, and xmelab. However, if you have INCISIVE in your installation path, you will see the INCISIVE-related commands, such as irun, ncvlog, and ncelab. However, if you set AMSXLMCOMPATIBLE, environment variable, you will always see the INCISIVE commands in the form even if you have Xcelium in your installation path.</div>

<h2>
<a id="pgfId-1040585"></a><a id="52030"></a>Setting Up Design <a id="setUpDesVars"></a>Variables</h2>
<p>
<a id="pgfId-1040591"></a>To set up design variables, do the following: </p>
<ol><li>
<a id="pgfId-1040597"></a>Copy the variables from the schematic by choosing <em>Variables &#8211; Copy from Cellview</em> in the ADE window. <br />
<a id="pgfId-1040606"></a>Design variables from the schematic appear in the <em>Design Variables</em> section of the ADE window. <br />
<a id="pgfId-1040611"></a><div class="webflare-div-image">
<img width="279" height="135" src="images/tutorial1-7.gif" /></div>
<a id="pgfId-1040607"></a><em>GAIN_PA</em> controls the gain of the RF power amplifier. <em>CP_PA</em> controls the compression point of the RF power amplifier. The compression point is a measurement of the amplifier&#8217;s linearity/nonlinearity: The smaller the number, the larger the amplifier&#8217;s nonlinearity. </li><li>
<a id="pgfId-1040621"></a>In the <em>Value</em> column for <em>GAIN_PA</em>, click and type <code>35</code>. </li><li>
<a id="pgfId-1040667"></a>In the <em>Value</em> column for <em>CP_PA</em>, click and type <code>24</code>. <br />
<a id="pgfId-1040685"></a><div class="webflare-div-image">
<img width="276" height="122" src="images/tutorial1-8.gif" /></div></li></ol>












<h2>
<a id="pgfId-1040596"></a><a id="16633"></a>Starting MATLAB before AMS <a id="beforeAMSstarts"></a>Starts</h2>
<p>
<a id="pgfId-1040730"></a>To set up MATLAB to start before AMS starts, do the following: </p>
<ol><li>
<a id="pgfId-1040734"></a>In ADE, choose <em>Setup &#8211; MATLAB/Simulink &#8211; Start</em>. <br />
<a id="pgfId-1040741"></a>The Setup MATLAB form appears. By default <em>Start MATLAB</em> is <em>no</em>. </li><li>
<a id="pgfId-1040879"></a>For <em>Start MATLAB</em>, select <em>before AMS starts</em>. <br />
<a id="pgfId-1040895"></a>This setting establishes a connection between the MATLAB/Simulink simulator and the AMS Designer simulator. The other fields on the form become active. <br />
<a id="pgfId-1040870"></a>The default MATLAB start command is <code>matlab</code>. <br />
<a id="pgfId-1040871"></a>The default MATLAB start-up directory is your current directory (where you started your Cadence software). <br />
<a id="pgfId-1040872"></a>The default delay to allow MATLAB initialization is 10 seconds. This delay allows MATLAB/Simulink to be ready and running when the AMS simulation starts. For successful cosimulation, you must coordinate start-up times such that MATLAB/Simulink is ready and running before AMS. <br /><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1040943"></a>You would set <em>Start MATLAB</em> to <em>now</em> to use the flow that runs the AMS Designer simulator and environment separate from the MATLAB/Simulink simulation. See <a href="tutorial1.html#96338">&#8220;Running Cosimulation by Starting the Two Simulations Separately&#8221;</a> for more information. </div></li><li>
<a id="pgfId-1040835"></a>In the <em>MATLAB design name</em> field, type <code>tutorial2r14</code>. <br />
<a id="pgfId-1040839"></a><div class="webflare-div-image">
<img src="images/SetupMATLAB.gif" /></div></li><li>
<a id="pgfId-1040756"></a>Click <em>OK</em>. <br />
<a id="pgfId-1041211"></a>You are ready to <a href="tutorial1.html#cosimADE">run cosimulation from ADE</a>. </li></ol>


















<h2>
<a id="pgfId-1040953"></a><a id="89180"></a>Running Cosimulation from <a id="cosimADE"></a>ADE</h2>
<p>
<a id="pgfId-1040957"></a>To start cosimulation from ADE, do the following: </p>
<ol><li>
<a id="pgfId-1040958"></a>Choose <em>Simulation &#8211; Netlist and Run</em> (or click the green Netlist and Run button). <br />
<a id="pgfId-1040965"></a>The testbench schematic appears in Simulink. The MATLAB Command Window does not appear. The AMS Designer simulator starts running. The cosimulation proceeds. The <code>simulation.log</code> and <code>matlab_ade.log</code> files appear in separate windows. Simulation data appears in the Simulink <em>Spectrum Scope</em> and <em>Received Signal</em> windows. <br />
<a id="pgfId-1042611"></a>The input spectrum and output spectrum are different owing to of the non-ideal RF transmitter chain. <br />
<a id="pgfId-1042615"></a><div class="webflare-div-image">
<img src="images/Scope1.gif" /></div>
<a id="pgfId-1042619"></a><div class="webflare-div-image">
<img src="images/Scope2.gif" /></div>
<a id="pgfId-1041110"></a><div class="webflare-div-image">
<img src="images/ReceivedSignalCo1.gif" /></div></li></ol>










<h2>
<a id="pgfId-1041112"></a>Changing a Value and Rerunning <a id="cosimADEchangevalue"></a>Cosimulation</h2>
<p>
<a id="pgfId-1041113"></a>Once you are <h-hot><a href="tutorial1.html#beforeAMSstarts">set up for cosimulation</a></h-hot>, changing values and rerunning the cosimulation is simple. To change a design variable value and rerun the cosimulation, do the following: </p>
<ol><li>
<a id="pgfId-1041096"></a>In the ADE window, double-click the value for <em>CP_PA</em> and change it to <code>18</code> (from 24). </li><li>
<a id="pgfId-1041128"></a>Click the run button (or choose <em>Simulation &#8211; Netlist and Run</em>). <br />
<a id="pgfId-1041135"></a>The cosimulation runs again with the changed value. <br />
<a id="pgfId-1041157"></a>The number of bit errors increases (you can view this information on the testbench scheamtic). The overall system behavior is still reasonable. <br />
<a id="pgfId-1041158"></a><div class="webflare-div-image">
<img src="images/Scope118.gif" /></div>
<a id="pgfId-1041139"></a><div class="webflare-div-image">
<img src="images/Scope218.gif" /></div>
<a id="pgfId-1041222"></a>The scatter plot reflects the larger amplifier nonlinearity owing to the change to the value of the <em>CP_PA</em> design variable. <br />
<a id="pgfId-1041165"></a><div class="webflare-div-image">
<img src="images/ReceivedSignal18.gif" /></div></li></ol>














<h2>
<a id="pgfId-1041179"></a><a id="96338"></a>Running Cosimulation by Starting the Two Simulations <a id="cosimADEseparate"></a>Separately</h2>
<p>
<a id="pgfId-1041440"></a>Previously, we demonstrated how you can run a cosimulation from ADE by setting the <em>Start MATLAB</em> option to <em><a href="tutorial1.html#beforeAMSstarts">before AMS starts</a></em>. To leverage the full funtionality of MATLAB, you can start MATLAB from ADE and run cosimulation by starting the two simulations separately. </p>
<p>
<a id="pgfId-1041398"></a><a id="exitMATLAB"></a>Before beginning this part of the tutorial, do the following: </p>
<ul><li>
<a id="pgfId-1041146"></a>Choose <em>File &#8211; Exit MATLAB</em>. </li></ul>
<p>
<a id="pgfId-1041340"></a>To run cosimulation by starting the two simulations separately, do the following: </p>
<ol><li>
<a id="pgfId-1041344"></a><a href="tutorial1.html#StartMATLABnow">Start MATLAB from ADE</a>. </li><li>
<a id="pgfId-1041481"></a><a href="tutorial1.html#twoSeparateSimulations">Start the two simulations separately</a>. </li></ol>

<h3>
<a id="pgfId-1041351"></a><a id="60631"></a>Starting MATLAB <a id="StartMATLABnow"></a>Immediately</h3>
<p>
<a id="pgfId-1041352"></a>To set up MATLAB to start immediately, do the following: </p>
<ol><li>
<a id="pgfId-1041353"></a>In ADE, choose <em>Setup &#8211; MATLAB/Simulink &#8211; Start</em>. <br />
<a id="pgfId-1041354"></a>The Setup MATLAB form appears. </li><li>
<a id="pgfId-1041355"></a>For <em>Start MATLAB</em>, select <em>now</em>. <br />
<a id="pgfId-1041356"></a>The <em>Start</em> button appears. <br />
<a id="pgfId-1041360"></a><div class="webflare-div-image">
<img src="images/StartMATLABnow.gif" /></div><div class="webflare-information-macro webflare-macro-note">
<a id="pgfId-1041364"></a>See <a href="tutorial1.html#16633">&#8220;Starting MATLAB before AMS Starts&#8221;</a> for information about the <em>before AMS starts</em> selection. </div></li><li>
<a id="pgfId-1041365"></a>Click <em>Start</em>. <br />
<a id="pgfId-1041366"></a>The MATLAB Command Window appears. The testbench schematic appears in Simulink. You are ready to cosimulate by <a href="tutorial1.html#twoSeparateSimulations">starting the two simulations separately</a>. </li></ol>
















<h3>
<a id="pgfId-1041370"></a>Starting the Two Simulations <a id="twoSeparateSimulations"></a>Separately</h3>
<p>
<a id="pgfId-1041371"></a>To start the two simulations separately, do the following: </p>
<ol><li>
<a id="pgfId-1041372"></a>In the Simulink testbench window, choose <em>Simulation &#8211; Start</em>. <br />
<a id="pgfId-1041373"></a>Messages appear in the MATLAB Command Window. One of the messages is this: <pre class="webflare-pre-block webflare-courier-new" id="#id1041374">
<a id="pgfId-1041374"></a>Waiting for incoming connection on port 5023, timeout: 120 sec ...</pre></li><li>
<a id="pgfId-1041375"></a>In the ADE window, choose <em>Simulation &#8211; Netlist and Run</em> (or click the Netlist and Run button) before this time interval expires. <br />
<a id="pgfId-1041376"></a>Once the <code>xmsim</code> simulation starts, the two applications establish a connection and the cosimulation proceeds. When the cosimulation finishes, the Spectrum Scope and Received Signal graph windows appear. You can view the number of bit errors on the testbench schematic. <br />
<a id="pgfId-1041377"></a>If you want to rerun the simulation, you will need to start Simulink and ADE again separately. </li></ol>









<br /><a href="#pagetop">Return to top</a><br /></div>
<!-- Begin Buttons --><!-- End Buttons -->
<footer><nav class="navigation"><b><em><a href="setup.html" id="prev" title="AMS-MATLAB/Simulink Cosimulation">AMS-MATLAB/Simulink Cosimulati ...</a></em></b><b><em><a href="tutorial2.html" id="nex" title="Running Cosimulation from ADE Using the simulinkCoupler">Running Cosimulation from ADE  ...</a></em></b></nav><div>
            For further assistance, contact <a href="https://support.cadence.com">Cadence Online Support</a>. Copyright &#169; 2023, <a href="https://www.cadence.com">Cadence Design Systems, Inc.</a> All rights reserved. 
          </div></footer>
 

 <div id="cad_image_modal" style="background-color: rgba(0, 0, 0, 0.6);"><center id="cad_image_modal_center">&#160;â € </center><span style="margin-right:50px;margin-top:100px;font-weight:bold;font-size:20px;background:#e5e5e5;border:1px solid #e5e5e5;border-radius:25px;height:30px;width:20px;padding-left:6px;padding-top:2px;color: black;" onclick="document.querySelector('#cad_image_modal').classList.remove('opac');">X</span></div> 

</body></html>